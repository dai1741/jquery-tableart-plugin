/**
 * TableArt
 * 
 * テーブルアートを生成するjQuery Plugin。
 * 
 * MITライセンスに準拠する。
 *  - http://www.opensource.org/licenses/mit-license.php
 * 
 * @author dai1741
 * @version 0.0
 * @see https://github.com/dai1741/jquery-tableart-plugin
 */
(function(f){var m={complete:function(){},imagebig:function(){return confirm("Image is way too big! Are you ok to create a huge table art?")},error:function(){},draw:!0,allowedImageVolume:8E4};jQuery.fn.tableArt=function(b,g){var n=this,c=f.extend(m,g),h=function(){c.error.apply(n,arguments)};if(!b.src||!b.width||!b.height){if(b.jquery&&0<b.length)return arguments.callee.call(this,b[0],g);h("Invalid param",1);return this}var d=b.width,e=b.height;if(d*e>=c.allowedImageVolume){if(f.isFunction(c.imagebig)&&
!c.imagebig.call(this,d*e))return h("Generation canceled due to image size",8),this}else if(0>=d*e)return h("Invalid resolution",1),this;return this.each(function(){var g=f(this),a=f('<canvas width="'+d+'" height="'+e+'"></canvas>')[0].getContext("2d");a.drawImage(b,0,0);try{if(!a.getImageData){c.error("context.getImageData() is not available",2);return}var i=a.getImageData(0,0,d,e).data}catch(m){h("context.getImageData() has encountered security exception",3);return}for(var a='<table width="'+d+
'" height="'+e+'" cellpadding="0" style="table-layout: fixed; border-collapse: collapse; border-spacing: 0px;"><tbody>\n',k=0;k<e;k++){for(var a=a+"<tr>\n",l=0;l<d;l++)var j=4*(k*d+l),a=a+('<td width="1" height="1" style="background-color: rgba('+i[j]+","+i[j+1]+","+i[j+2]+","+i[j+3]+');"></td>\n');a+="</tr>\n"}a+="</tbody></table>";if(c.draw)var o=f('<div class="tableart-artholder"></div>').html(a).appendTo(g);f.isFunction(c.complete)&&c.complete.call(n,c.draw?o.find("table")[0]:null,a)})}})(jQuery);